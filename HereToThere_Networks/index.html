<html>
<head>
    <title>A D3 map</title>
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="js/neighborhoodsMSP.js"></script>
    <script src="js/nhoodsLocs.js"></script>
    
    <style type="text/css">
    circle {
        fill: blue;
        fill-opacity: .8;
        stroke: #fff;
        }
    #states path {
    fill: #ccc;
    stroke: #fff;
    }
   

 .arcs{
	  
      //pointer-events:visibleStroke;
      stroke: red;
      stroke-width:10;
      stroke-opacity:0;
	
	}

 .arcs:hover{
	  
      //pointer-events:visibleStroke;
      stroke: red;
      stroke-width:5;
      stroke-opacity:100;
	
	}



  circle:hover.arcs {
	  stroke: blue;
      
	  
	}

    /*.arcs:hover{
	  stroke-width: 3px;
	  stroke: tomato;
	
	}*/

    </style>

    
</head>
<body>
    <script>
        var width = 700,
    height = 580;

        var svg = d3.select("body")
          .append("svg")
          .attr("width", width)
          .attr("height", height);

        var g = svg.append("g");

        var albersProjection = d3.geoAlbers()
          .scale(190000)
          .rotate([93.2650, 0])
          .center([0, 44.9778])
          .translate([width / 2, height / 2]);

        var geoPath = d3.geoPath()
            .projection(albersProjection)
            .pointRadius(2.5);
       
        //start refactoring




        g.selectAll("path")
          .data(neighborhoods_json.features)
          .enter()
          .append("path")
          .attr("fill", "#ccc")
          .attr("stroke","#fff")
          .attr("d", geoPath);
        d3.csv("https://docs.google.com/spreadsheets/d/1ZKBvaJ2Vru1v37ufPXI-XE_bD1iSMPsXLcRWd7t3Vow/pub?gid=1870254444&single=true&output=csv", function (error, data) {
            //Start Filter
            data = data.filter(function (row) {
                return row['TimeAgo'] >= 0;
            });

            //end filter

            for (var i in data) {
                data[i].arcs = { type: "LineString", coordinates: [] };
            };

            data.forEach(function (d) {
                var source = [d.OLon, d.OLat]
                var target = [d.NewLon, d.NewLat]
                d.arcs.coordinates.push(source)
                d.arcs.coordinates.push(target)
                //console.log(d.arcs.coordinates)
            });
            //Debug
            //console.log(data.length);
            //data[0].test="12"
            //console.log(data[0].test);
            //console.log(data);

            g.selectAll("circle")
               .data(data)
               .enter()
               .append("circle")
               .attr("cx", function (d) {
                   return albersProjection([d.OLon, d.OLat])[0];
               })
               .attr("cy", function (d) {
                   return albersProjection([d.OLon, d.OLat])[1];
               })
               .attr("r", 5)
                //test
                .exit()

            //meighborhoods = data.filter
            //var neighborhoods = svg.selectAll(".neighborhood")
            //.data(data)
            console.log("Hi");
            console.log(data);



            //append routes to city data
            d3.json("nhoodLocs", function (error, nhoods) {
                console.log(nhoods)
            });

       

            g.selectAll("arcs")
                .data(data)
                .enter()
                .append("path")
                .attr("class","arcs")
                .attr("d", function (d) { return geoPath(d.arcs) })
            console.log(g);
        });

            /*var arcs = svg.append("g")
                .attr("class", "arcs");
            arcs.selectAll("path")
                .data(data)
                .enter()
                .append("path")
                .attr("d", function (d) { return geoPath(d.arcs) */

            

       


                
        </script>
</body>
</html>
